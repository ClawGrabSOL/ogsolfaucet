<!DOCTYPE html>
<html>
<head>
    <title>Free Solana!</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Georgia, serif;
            font-size: 14px;
            margin: 0;
            padding: 20px;
            background: #fff;
        }
        h1 {
            color: #9945FF;
            font-size: 48px;
            margin: 0 0 20px 0;
            font-weight: normal;
        }
        h2 {
            font-size: 18px;
            margin: 25px 0 10px 0;
        }
        a {
            color: #14F195;
        }
        #container {
            display: flex;
            max-width: 900px;
        }
        #sidebar {
            width: 120px;
            padding-right: 20px;
            font-size: 13px;
        }
        #sidebar b {
            font-size: 14px;
        }
        #main {
            flex: 1;
        }
        #faucet-img {
            width: 100px;
            margin-bottom: 15px;
        }
        input[type="text"] {
            font-size: 14px;
            padding: 2px;
        }
        button {
            font-size: 14px;
            padding: 2px 10px;
        }
        #captcha-box {
            border: 2px solid #c0c0c0;
            background: #ffffcc;
            padding: 15px;
            margin: 15px 0;
            display: inline-block;
        }
        #captcha-question {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #message {
            color: green;
            font-weight: bold;
        }
        #message.error {
            color: red;
        }
        code {
            background: #f0f0f0;
            padding: 2px 5px;
        }
    </style>
</head>
<body>

<div id="container">
    <div id="sidebar">
        <!-- Purple Faucet SVG -->
        <svg id="faucet-img" viewBox="0 0 100 120">
            <!-- pipe coming from wall -->
            <rect x="60" y="0" width="15" height="35" fill="#9945FF"/>
            <!-- faucet body -->
            <ellipse cx="50" cy="45" rx="30" ry="15" fill="#9945FF"/>
            <rect x="20" y="45" width="60" height="8" fill="#9945FF"/>
            <!-- spout -->
            <path d="M20 48 Q0 50 5 70 L15 68 Q12 55 25 53 Z" fill="#9945FF"/>
            <!-- handle top -->
            <rect x="43" y="20" width="14" height="25" fill="#9945FF"/>
            <ellipse cx="50" cy="18" rx="12" ry="6" fill="#9945FF"/>
            <!-- water drops -->
            <ellipse cx="10" cy="80" rx="4" ry="6" fill="#14F195"/>
            <ellipse cx="8" cy="95" rx="3" ry="5" fill="#14F195"/>
            <ellipse cx="12" cy="108" rx="2" ry="4" fill="#14F195"/>
            <!-- highlight -->
            <ellipse cx="35" cy="42" rx="8" ry="4" fill="#b57fff" opacity="0.5"/>
        </svg>
        
        <p>
            <b><span id="balance">...</span> SOL</b><br>
            available
        </p>
        
        <p>
            <b>Other Sites:</b><br>
            <a href="https://solana.com">Solana.com</a><br>
            <a href="https://phantom.app">Phantom Wallet</a>
        </p>
    </div>
    
    <div id="main">
        <h1>Free Solana!</h1>
        
        <h2>Get Solana from the SOL Faucet</h2>
        
        <p>
            I'm giving away <b>0.001 SOL</b> per visitor; just solve the "captcha" then enter your Solana Receiving address and press Get Some:
        </p>
        
        <div id="captcha-box">
            <div id="captcha-question">3 + 4 =</div>
            <input type="text" id="captcha-answer" size="6" placeholder="?">
        </div>
        
        <p>
            Your Solana Address: <input type="text" id="wallet" size="45">
            <button id="claim-btn" onclick="claim()">Get Some!</button>
        </p>
        
        <p id="message"></p>
        
        <h2>What is Solana?</h2>
        <p>
            Solana is a high-performance blockchain. It's fast, cheap, and used by millions of people worldwide.
            Visit the <a href="https://solana.com">Solana.com</a> website for all the geeky details.
        </p>
        
        <h2>How do I get a Solana Receiving Address?</h2>
        <p>
            Download and install a wallet like <a href="https://phantom.app">Phantom</a>. 
            Your wallet address will be shown at the top - it's a long string starting with a letter.
        </p>
        
        <h2>I've got Solana; how can I help?</h2>
        <p>
            Send SOL to the faucet at address <code id="faucet-address">...</code> and they'll be given away. 
            It may take up to 30 minutes for your donation to be added to the amount available.
        </p>
        
        <h2>What's the catch?</h2>
        <p>
            No catch-- I want Solana to be successful, so I created this little service to give you a few coins to start with.<br>
            -- <a href="https://x.com/ClawGrabSOL">claw</a>
        </p>
    </div>
</div>

<script>
let captchaAnswer = 0;

function newCaptcha() {
    const a = Math.floor(Math.random() * 10) + 1;
    const b = Math.floor(Math.random() * 10) + 1;
    document.getElementById('captcha-question').textContent = a + ' + ' + b + ' =';
    document.getElementById('captcha-answer').value = '';
    captchaAnswer = a + b;
}

async function fetchInfo() {
    try {
        const res = await fetch('/api/info');
        const data = await res.json();
        document.getElementById('balance').textContent = data.balance.toFixed(4);
        document.getElementById('faucet-address').textContent = data.wallet;
    } catch (e) {
        console.error(e);
    }
}

async function claim() {
    const wallet = document.getElementById('wallet').value.trim();
    const answer = parseInt(document.getElementById('captcha-answer').value);
    const msg = document.getElementById('message');
    const btn = document.getElementById('claim-btn');
    
    msg.className = '';
    
    if (!wallet || wallet.length < 32) {
        msg.className = 'error';
        msg.textContent = 'Please enter a valid Solana address.';
        return;
    }
    
    if (answer !== captchaAnswer) {
        msg.className = 'error';
        msg.textContent = 'Wrong captcha answer, try again.';
        newCaptcha();
        return;
    }
    
    btn.disabled = true;
    btn.textContent = 'Sending...';
    msg.textContent = '';
    
    try {
        const res = await fetch('/api/claim', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ wallet: wallet, captcha: answer })
        });
        
        const data = await res.json();
        
        if (data.success) {
            msg.innerHTML = '0.001 SOL sent! <a href="https://solscan.io/tx/' + data.txHash + '">View transaction</a>';
            fetchInfo();
        } else {
            msg.className = 'error';
            msg.textContent = data.error || 'Something went wrong.';
        }
    } catch (e) {
        msg.className = 'error';
        msg.textContent = 'Error connecting to server.';
    }
    
    btn.disabled = false;
    btn.textContent = 'Get Some!';
    newCaptcha();
}

newCaptcha();
fetchInfo();
</script>
</body>
</html>
