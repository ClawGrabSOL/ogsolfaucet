<!DOCTYPE html>
<html>
<head>
    <title>Free Solana!</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<h1>Free Solana!</h1>

<p>
    To len't make sure you're not a bot, please solve this captcha:
</p>

<p>
    <b id="captcha-question">5 + 7 = </b>
    <input type="text" id="captcha-answer" size="5">
</p>

<p>
    Solana address: <input type="text" id="wallet" size="50">
</p>

<p>
    <button id="claim-btn" onclick="claim()">Send me SOL!</button>
</p>

<p id="message"></p>

<hr>

<p>
    <b>What's this?</b><br>
    Once upon a time, receiving free bitcoin was as simple as visiting a website and clicking a button.
    This is like that, but for Solana.<br><br>
    
    Everybody who visits gets <b>0.01 SOL</b>. Come back tomorrow for more!
</p>

<hr>

<p>
    <b>Stats:</b><br>
    Faucet balance: <span id="balance">...</span> SOL<br>
    Total given away: <span id="total-sent">...</span> SOL to <span id="total-claims">...</span> people
</p>

<hr>

<p>
    <b>Recent recipients:</b>
</p>
<pre id="claims-list">loading...</pre>

<hr>

<p>
    <small>
        This faucet is funded by donations. Want to help?<br>
        Send SOL to: <code id="faucet-address">loading...</code>
    </small>
</p>

<p>
    <small>
        <a href="#" id="wallet-link">View faucet wallet on Solscan</a>
    </small>
</p>

<script>
let captchaAnswer = 0;

function newCaptcha() {
    const a = Math.floor(Math.random() * 10) + 1;
    const b = Math.floor(Math.random() * 10) + 1;
    document.getElementById('captcha-question').textContent = a + ' + ' + b + ' = ';
    document.getElementById('captcha-answer').value = '';
    captchaAnswer = a + b;
}

async function fetchInfo() {
    try {
        const res = await fetch('/api/info');
        const data = await res.json();
        
        document.getElementById('balance').textContent = data.balance.toFixed(4);
        document.getElementById('total-claims').textContent = data.totalClaims;
        document.getElementById('total-sent').textContent = data.totalSent.toFixed(2);
        document.getElementById('faucet-address').textContent = data.wallet;
        document.getElementById('wallet-link').href = 'https://solscan.io/account/' + data.wallet;
        
        if (data.recentClaims && data.recentClaims.length > 0) {
            document.getElementById('claims-list').textContent = data.recentClaims
                .map(c => c.wallet.slice(0,8) + '...' + c.wallet.slice(-4) + '  0.01 SOL')
                .join('\n');
        } else {
            document.getElementById('claims-list').textContent = '(none yet)';
        }
    } catch (e) {
        console.error(e);
    }
}

async function claim() {
    const wallet = document.getElementById('wallet').value.trim();
    const answer = parseInt(document.getElementById('captcha-answer').value);
    const msg = document.getElementById('message');
    const btn = document.getElementById('claim-btn');
    
    if (!wallet || wallet.length < 32) {
        msg.textContent = 'Please enter a valid Solana address.';
        return;
    }
    
    if (answer !== captchaAnswer) {
        msg.textContent = 'Wrong answer, try again.';
        newCaptcha();
        return;
    }
    
    btn.disabled = true;
    btn.textContent = 'Sending...';
    msg.textContent = '';
    
    try {
        const res = await fetch('/api/claim', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ wallet: wallet, captcha: answer })
        });
        
        const data = await res.json();
        
        if (data.success) {
            msg.innerHTML = 'Sent! <a href="https://solscan.io/tx/' + data.txHash + '">View transaction</a>';
            fetchInfo();
        } else {
            msg.textContent = data.error || 'Something went wrong.';
        }
    } catch (e) {
        msg.textContent = 'Error connecting to server.';
    }
    
    btn.disabled = false;
    btn.textContent = 'Send me SOL!';
    newCaptcha();
}

newCaptcha();
fetchInfo();
setInterval(fetchInfo, 30000);
</script>
</body>
</html>
